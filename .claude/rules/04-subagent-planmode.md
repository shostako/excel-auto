# サブエージェント・Plan Mode運用ルール

## サブエージェント機能活用方針

**検証済み**: 2025-11-07にGemini提供情報をファクトチェック完了

### 基本方針

- **大規模調査**: Exploreサブエージェントに委任（10.8倍の効率化）
- **独立タスク**: 並列実行で処理（1.8倍の効率化）
- **簡単な調査**: 直接実行（速度優先）

### 使用推奨場面

- 参考マクロの分析: Explore (medium)
- 複数マクロの最適化確認: Explore (quick)
- 新機能の実装計画: Plan (sonnet)
- ドキュメント全体の見直し: 4x Explore並列

### 詳細ガイド

- **ベストプラクティス**: `docs/claude-code-references/SUBAGENT_BEST_PRACTICES.md`
- **検証レポート**: `docs/claude-code-references/SUBAGENT_VERIFICATION_REPORT.md`
- **クイックリファレンス**: `docs/claude-code-references/README.md`

---

## Plan Mode運用ルール

**重要**: Plan Modeは計画確認のために有用だが、調査フェーズでの効率化が必要。

### Plan Modeの価値（維持すべき）

- 計画を立ててユーザー確認を取る
- 一気に実装せず、段階的に進める
- 予期しない変更を防ぐ

### Plan Mode内での調査方法

**読み取り専用操作は直接実行**（サブエージェント不要）：
- `iconv -f SHIFT-JIS -t UTF-8`（文字コード変換）
- `cat`, `head`, `tail`（ファイル表示）
- `ls`（ファイル一覧）
- `grep`（検索）

**理由**：
- サブエージェントは最新設定（フック等）を知らない
- サブエージェントは実行を避けて推測する傾向
- 直接実行の方が速く正確（10秒 vs 2分以上）

**サブエージェントを使うべき調査**：
- 複数ファイルにまたがる構造分析
- コードベース全体の理解が必要な調査
- 複雑な依存関係の調査

### VBAマクロ作業でのPlan Mode

1. **Plan modeは維持**（計画確認のため）
2. **調査は直接実行**（iconvでファイル読む）
3. **excel-vba-expertスキルの早期活用**
   - 計画段階からスキルの知識を参照
   - 計画提示後にスキル起動して実装
4. **ユーザー確認後に実装開始**

### 理想的なフロー（VBAマクロ作業）

```
ユーザー: 「コメント標準化して」
     ↓
Plan mode開始
     ↓
直接iconvでファイル読む（10秒）← サブエージェント不要
     ↓
excel-vba-expertの知識で計画立案
     ↓
ExitPlanModeで計画提示
     ↓
ユーザー: 「OK」or「開始」
     ↓
スキル起動 + 実装
```
