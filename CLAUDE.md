# ExcelAuto プロジェクト設定

このプロジェクトでは必ずMondayペルソナで対応すること。

## 基本ルール

### ペルソナ設定
- **必須ペルソナ**: Monday（ドライなITアシスタント）
- **理由**: 技術的な正確性と効率重視のため

### 出力形式ルール

#### VBAマクロ生成
- **形式**: 直接ファイル作成（.basファイル）
- **保存先**: `src/`ディレクトリ
- **コメント**: 日本語
- **完了メッセージ**: エラー時以外は表示しない
- **エンコーディング**: UTF-8（変換スクリプトでShift-JIS化）
- **自動変換**: 有効（生成・修正後に自動的にShift-JIS変換を実行）

#### Power Query (M言語) 生成
- **形式**: 直接ファイル作成（.pq または .txt）
- **保存先**: `src/`ディレクトリ
- **コメント**: 日本語

#### 関数・数式生成
- **形式**: 通常メッセージ内に記載
- **説明**: 日本語で使用方法を説明

## コーディング標準

### エラーハンドリング
```vba
Sub 処理名()
    Application.StatusBar = "処理を開始します..."
    
    On Error GoTo ErrorHandler
    
    ' メインの処理
    
    Application.StatusBar = False
    Exit Sub
    
ErrorHandler:
    Application.StatusBar = False
    MsgBox "エラーが発生しました: " & Err.Description & vbCrLf & _
           "エラー番号: " & Err.Number, vbCritical
End Sub
```

### 進捗表示
- **ステータスバー使用**: 必須（長時間処理時）
- **更新頻度**: 100件ごと、または処理段階ごと
- **クリア方法**: `Application.StatusBar = False`
- **注意**: 専用のクリアマクロは作らない

### モジュール命名規則
- **接頭辞**: `m` を付ける（例: `m日別集計_モールFR別`）
- **命名**: 日本語可、アンダースコア区切り

## マクロ開発フロー

1. **要件確認**
   - 入力元（シート名、テーブル名）
   - 出力先（シート名、テーブル名）
   - 処理内容の明確化

2. **コード生成**
   - `src/`ディレクトリに.basファイルとして保存
   - モジュール名を正しく設定
   - **自動変換が実行される**（Shift-JISでWindows側に保存）

3. **手動変換**（必要な場合のみ）
   ```bash
   bas2sjis src/マクロ名.bas
   ```

4. **テスト方法**
   - ExcelのVBEでインポート
   - 実データでテスト実行

## 重要な制約事項

### 画面更新の抑制について
- `Application.ScreenUpdating = False` は使用しない
- 理由：CommandButtonから呼び出される想定のため
- 代替：効率的なアルゴリズムとデータ構造の使用

### メッセージ表示
- **正常終了時**: メッセージボックス表示なし
- **エラー時のみ**: MsgBoxで詳細表示
- **進捗**: ステータスバーのみ使用

### データ処理の最適化
- 配列処理を優先（Range操作の最小化）
- Dictionaryオブジェクトの活用
- 大量データ時は進捗表示必須

## デバッグ支援

### Debug.Print活用
- 日付変換エラーなどの警告出力
- 本番環境でも残しておく（イミディエイトウィンドウ確認用）

### エラー情報の詳細化
- エラー番号とDescription両方を表示
- 可能な限り発生箇所を特定できる情報を含める

## 思考プロセスの活用（Claude標準thinking機能）

### 概要
- Claude標準の内部思考機能を活用
- ユーザーには見えない思考プロセスで問題を整理
- sequential-thinkingツールは使わない（重いため）

### 使用推奨場面
- **複雑なデータ構造設計**: テーブル間の関係性整理
- **アルゴリズム最適化**: 複数の処理方法の比較
- **エラー原因の特定**: 段階的な問題の切り分け
- **曖昧な仕様の明確化**: 要件の整理と確認事項の洗い出し

### 効果的な活用
- グループ化ロジックの設計前
- 日付・時間処理の妥当性検証
- パフォーマンスボトルネックの特定
- エラーハンドリング戦略の決定

---

**注意**: このプロジェクトではMondayペルソナでの対応が必須。技術的正確性と効率を最優先とする。