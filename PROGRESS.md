# プロジェクト進捗状況

## 現在の状態
- **最終更新**: 2026-01-21 20:45
- **アクティブタスク**: なし（全タスク完了）

## 進行中
- なし

## 完了済み（今回セッション・夜2）
- [x] 成形P統合マクロ・シート作成
  - m転記_統合_成形P.bas新規作成
  - G→T→Hテーブルをコピー（タイトル行含む）
  - 期間ごとに改ページ、印刷範囲設定
- [x] 加工P統合マクロ・シート作成
  - m転記_統合_加工P.bas新規作成
- [x] 塗装P統合マクロ・シート作成
  - m転記_統合_塗装P.bas新規作成
- [x] 各一括マクロにP追加
  - m転記_一括_成形.bas, m転記_一括_加工.bas, m転記_一括_塗装.bas
- [x] 印刷レイアウト修正
  - CenterVertically = False, CenterHorizontally = False追加
  - 3つのPマクロすべてに適用

## 完了済み（今回セッション・夜）
- [x] m転記_見せる表_加工.bas - 加工NWからショット数取得追加
  - 期間検証追加（加工G vs 加工NW）
  - 7行目ショット数の転記元を流出G→加工NWに変更
- [x] m転記_一括_加工.bas - 加工NWシート追加
  - 対象シート・テーブル・マクロ配列に加工NW追加
- [x] mクエリ参照元変更_複数月対応.bas - 日報加工クエリ追加
  - 対象シート配列に「加工NW」追加
  - `Create日報加工複数月結合Query`関数追加

## 完了済み（今回セッション・夕方）
- [x] m転記_日報_加工NW.bas - 新規作成（塗装NWベース）
  - パターンA: 62-xxxxx形式 → FrLH/RH両方（×1）
  - パターンB: ロット=「単」かつ特定数字含む → 特定1グループ（×2）
  - 補給品: 上記以外（ロット=「単」→×2、それ以外→末尾LH/RH判定）

## 完了済み（今回セッション・午後2）
- [x] m転記_廃棄_成形H/塗装H/加工H.bas - ショット数処理全削除、ロット数量テーブル不参照
- [x] m転記_流出_成形G/塗装G/加工G.bas - ショット数処理全削除、ロット数量テーブル不参照
- [x] m転記_流出_成形G.bas - BubbleSortDesc → QuickSortDescに統一

## 完了済み（今回セッション・午後）
- [x] 手直しクエリ.pq - 年単位ファイル単独参照、品番末尾・注番月列除外
- [x] mクエリ参照元変更_複数月対応.bas - ロット数量/番号固定クエリ削除、手直しシート除外
- [x] m転記_手直し_成形T/塗装T/加工T.bas - ショット数処理全削除、ロット数量テーブル不参照

## 完了済み（今回セッション・午前）
- [x] UserForm5 ID範囲指定対応（22-25 → 22,23,24,25）
- [x] UserForm5 DataModifiedフラグ追加（クエリ更新判定用）
- [x] UserForm5 削除モード対応（データ無効化、実行後フォーム閉じる）
- [x] mゾーン別データ転送ADO.bas - 品番末尾・注番月フィールド削除
- [x] mクエリ西暦更新.bas - 新規作成（Power Query接続先を動的変更）
- [x] 不良集計ゾーン別ADO.pq - 年間DBのみ参照に変更
- [x] m自動採番リセットAccess.bas - DBパス動的構築対応

## 完了済み（前回セッション）
- [x] UserForm5 レイアウト微調整
- [x] UserForm5 入力制限追加（CTextBoxEventクラスハンドラ接続）
- [x] UserForm5 フォント設定（Meiryo UI, Yu Gothic UI）
- [x] UserForm5 ID欄の窪み対応
- [x] UserForm5 選択列削除
- [x] UserForm5 TabIndex設定
- [x] UserForm5 誤操作防止

## 完了済み（前回セッション）
- [x] UserForm2から品番末尾（ComboBox3）と注番月（TextBox2）を削除
- [x] CTextBoxEvent.clsからMonthタグ処理を削除
- [x] mゾーン別データ転送ADO.basから品番末尾・注番月フィールドを削除
- [x] UserForm5（データ修正・削除フォーム）新規作成
  - IDベースでAccessデータを検索・修正・削除
  - トグルボタンで修正/削除モード切替
  - 動的コントロール生成（ヘッダーラベルも動的）
  - 最大10件同時処理対応
  - トランザクション制御（エラー時ロールバック）

## 完了済み（過去）
- [x] VBAマクロ開発基盤（src/macros分離、bas2sjis変換スクリプト）
- [x] PermissionRequestフック削除（MCPツール不使用のため簡素化）
- [x] Plan Mode運用ルール策定（CLAUDE.mdに追記）
- [x] コメント標準化（入力開始セル選択、番号転送ADO、ロット数量調査など）
- [x] Makefile整備（clean自動モード対応）
- [x] 空欄項目の不良数集計バグ修正（G系列2ファイル + H系列3ファイル）
- [x] G系列タイトル表記変更（流出G_成形_期間1_... → 成形_流出手直し（廃棄込）...）
- [x] フィルターマクロ排他的方式実装（完成品/側板/小部品は排他、項目は独立）
- [x] 側板フィルター・項目フィルター新規追加
- [x] テーブル名パターン検索対応（シートコピー時の「_完成品2」等に対応）
- [x] 日付表示マクロ新規追加（A3の日付を画面左端にスクロール）
- [x] フィルターマクロ水平スクロール維持（垂直のみスクロール）
- [x] 複合フィルター対応（完成品/側板/小部品 AND 項目フィルター）
- [x] 項目フィルターカンマ区切り対応（「実績,計画」等でOR条件）
- [x] イベントコード分配方式変更（Workbook_SheetChange → 各シートのWorksheet_Change）
- [x] 項目フィルター「合計」「稼働日」行常時表示機能追加
- [x] /wrapコマンド新規作成（セッション終了処理一括実行）
- [x] .claude/rules/ディレクトリ導入（CLAUDE.md分割管理）
- [x] 項目追加マクロ汎用化（テーブル名・項目名を引数指定）
- [x] 項目削除マクロ新規作成（テーブル名・項目名を引数指定）
- [x] フィルター解除マクロ改修（オートフィルターリセット機能追加）
- [x] wrap時クリーンアップルール明確化（inbox/macros自動クリア、src確認なしコミット）
- [x] フィルターマクロ オートフィルター方式へ全面変更（複合フィルター対応、手動オートフィルター維持）
- [x] 項目追加マクロ全テーブル対応（_core/_slitter/_acf系にも対応、列存在チェック方式）
- [x] Windows環境問題分析（Claude CodeのGit Bash依存が原因、WSL環境に戻す決定）
- [x] Windows版ナレッジのWSL版マージ（コーディング規約、参照名確認ルール等）
- [x] /vbaコマンド新規作成（VBAマクロ生成ワークフロー）

## 未完了・保留
- なし

## 次セッションへの引き継ぎ
- **P統合シート完成**: 成形P/加工P/塗装P
  - G→T→Hテーブルをタイトル行含めてコピー
  - 期間ごとに改ページ、印刷範囲自動設定
  - 各一括マクロの最後に実行される
- **Pシートに必要なテーブル**: `_流出項目{工程}P`, `_集計期間{工程}P`
- **加工NW関連マクロ整備完了**: すべてに加工NW統合済み
- **ロット数量テーブル廃止準備完了**: 9マクロすべてが不参照に
- **参照すべきリソース**:
  - `src/m転記_統合_成形P.bas`（P統合マクロのテンプレート）
  - `src/m転記_日報_加工NW.bas`（複雑な集計ロジック）

## 直近のGitコミット
- fce2da6 feat: 加工NW系マクロ追加、転記マクロ群(T/H/G/NW)整備
- 33d1949 feat: UserForm5機能追加、転送・クエリ・採番リセットマクロ改修
