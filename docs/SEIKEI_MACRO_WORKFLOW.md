# 成形号機別マクロ実行フロー

## 概要

このドキュメントは、成形号機別データの集計・転記・分析を行う3つのマクロの実行フローを解説します。
これらのマクロは連携して動作し、日別データから最終的な集計表への転記まで一連の処理を自動化します。

## 全体フロー概要

```
日別データ → 集計 → 転記 → 最終出力
```

## 処理ステップ詳細

### ステップ1: 日別集計処理
**マクロ名**: `m日別集計_成形号機別`

**目的**: 成形工程の日別データを機械ごとに集計

**処理内容**:
- ソース: シート「クエリ成形」テーブル「_クエリ成形」
- 集計キー: 日付 + 機械番号
- 集計項目: 実績、不良、稼働時間、段取時間の合計値
- 出力先: シート「成形号機別」テーブル「_成形号機別a」

**実行タイミング**: 日次（データ更新時）

**出力例**:
```
日付       | 機械 | 実績 | 不良 | 稼働時間 | 段取時間
2024/01/15 | SS01 | 1250 | 15   | 8.0      | 1.0
2024/01/15 | SS02 | 1180 | 12   | 7.5      | 0.8
2024/01/15 | SS03 | 980  | 8    | 6.8      | 0.5
```

---

### ステップ2: 号機別データ転記
**マクロ名**: `m転記_シート成形号機別`

**目的**: 集計データを号機別テーブルに転記

**処理内容**:
- ソース: テーブル「_成形号機別a」（ステップ1の出力）
- ターゲット: テーブル「_成形号機別b」
- 対象機械: SS01-SS05（1-5号機の固定構成）
- 転記データ: 実績、不良実績、稼働時間（稼働時間+段取時間の合計）
- 処理方式: 日付ベースでのマッピング転記

**実行タイミング**: 日次（ステップ1実行後）

**転記例**:
```
日付       | 1号機日実績 | 1号機日不良実績 | 1号機日稼働時間 | 2号機日実績 | ...
2024/01/15 | 1250        | 15              | 9.0             | 1180        | ...
```

---

### ステップ3: 集計表への詳細転記
**マクロ名**: `m転記_集計表_成形号機別`

**目的**: ジャンル別ライン分析用の詳細データを集計表に転記

**処理内容**:
- ソース: テーブル「_成形号機別b」（ステップ2の出力）
- 基準日付: シート「集計表」セルA1
- ライン構成:
  - **1-2号機ライン**: 特定ジャンル製品（12合計で管理）
  - **3-4号機ライン**: 別ジャンル製品（34合計で管理）
  - **5号機**: 独立稼働
- 転記指標: 12種類（日ｼｮｯﾄ、日実績、日出来高ｻｲｸﾙ、累計ｼｮｯﾄ、累計実績、平均実績、平均出来高ｻｲｸﾙ、日不良実績、日不良率、累計不良実績、累計不良率、平均不良数）
- 出力先: シート「集計表」4-16行目、F-P列（6列構成）

**実行タイミング**: 分析時（集計表更新時）

**転記例**:
```
指標           | F列(1号機) | H列(2号機) | J列(12合計) | L列(3号機) | N列(4号機) | P列(34合計)
4行目(日ｼｮｯﾄ)  | 1500       | 1420       | 2920        | 1200       | 1150       | 2350
5行目(日実績)   | 1250       | 1180       | 2430        | 980        | 950        | 1930
6行目(日出来高) | 2.1        | 2.0        | 2.05        | 1.8        | 1.7        | 1.75
```

## 実行順序とタイミング

### 日次処理
1. **m日別集計_成形号機別** - 日別データの機械別集計
2. **m転記_シート成形号機別** - 号機別テーブルへの転記

### 分析時処理
1. **m転記_集計表_成形号機別** - ジャンル別ライン分析用データ転記

## データフロー

```
[クエリ成形] 
    ↓ (日別集計)
[_成形号機別a] 
    ↓ (号機別転記)
[_成形号機別b] 
    ↓ (詳細転記)
[集計表4-16行目]
```

## ジャンル別ライン構成

### 生産ライン区分
- **1-2号機ライン**: 特定ジャンルの製品を生産
- **3-4号機ライン**: 別ジャンルの製品を生産
- **5号機**: 独立稼働（特殊用途）

### 合計管理の意義
- **12合計**: 1-2号機ラインの総合パフォーマンス分析
- **34合計**: 3-4号機ラインの総合パフォーマンス分析
- **ジャンル比較**: 異なる製品ジャンル間の生産性・品質比較

### 集計表での配置
```
F列: 1号機 → H列: 2号機 → J列: 12合計 → L列: 3号機 → N列: 4号機 → P列: 34合計
```

## 重要なポイント

### 固定構成システム
- SS01-SS05の5台固定構成
- 機械追加時は手動でマクロ修正が必要
- 拡張性よりも安定性を重視した設計

### ジャンル別分析の重要性
- 製品ジャンルごとの生産特性把握
- ライン別の改善点特定
- 設備投資判断の根拠データ提供

### データ品質管理
- 空白値は自動的に0に変換
- 日付不整合時はエラー表示
- Debug.Printによる警告出力

## 運用上の注意点

1. **実行順序の遵守**: ステップ1→2→3の順序で実行
2. **日付整合性**: 各ステップで同じ日付データを使用
3. **機械コード**: SS01-SS05以外は処理対象外
4. **エラー確認**: イミディエイトウィンドウで警告メッセージをチェック

## エラー時の対処

### よくあるエラーと対処法

#### 1. 「機械コードが見つかりません」
**原因**: SS01-SS05以外の機械データ
**対処**: 対象機械のデータのみ処理される（正常動作）

#### 2. 「日付が見つかりません」
**原因**: 集計表A1の日付に対応するデータなし
**対処**: データの存在確認、日付形式の確認

#### 3. 「列が見つかりません」
**原因**: テーブル構造の不一致
**対処**: テーブル列名の確認、手動修正

## パフォーマンス特性

- **処理時間**: 通常2-3分（データ量により変動）
- **処理件数**: 日次で5台分のデータ
- **転記処理**: 72件（6ライン×12指標）

---

*この文書は成形号機別システムの実際の運用に基づいて作成されています。ジャンル別ライン分析により、製品特性に応じた最適な生産管理が可能になります。*