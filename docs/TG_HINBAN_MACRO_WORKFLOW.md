# TG品番別マクロ実行フロー

## 概要

このドキュメントは、TG品番別データの集計・転記・分析を行う3つのマクロの実行フローを解説します。
これらのマクロは連携して動作し、TG工程（加工3）の日別データから最終的な集計表への転記まで一連の処理を自動化します。

## 全体フロー概要

```
日別データ → 集計 → 転記 → 最終出力
```

## 処理ステップ詳細

### ステップ1: 日別集計処理
**マクロ名**: `m日別集計_TG品番別`

**目的**: TG工程（加工3）の日別データを品番ごとに集計

**処理内容**:
- ソース: シート「クエリ全工程」テーブル「_クエリ全工程」
- 対象工程: 「加工3」のデータのみ
- 集計キー: 日付 + 品番
- 集計項目: 実績、不良、稼働時間、段取時間の合計値
- 出力先: シート「TG品番別」テーブル「_TG品番別a」

**実行タイミング**: 日次（データ更新時）

**出力例**:
```
日付       | 品番         | 実績 | 不良 | 稼働時間 | 段取時間
2024/01/15 | 53827-60050  | 180  | 3    | 7.2      | 0.8
2024/01/15 | 53828-60080  | 165  | 2    | 6.9      | 0.6
```

---

### ステップ2: RH/LH品番別データ転記
**マクロ名**: `m転記_シートTG品番別`

**目的**: 集計データをRH/LH分類テーブルに転記

**処理内容**:
- ソース: テーブル「_TG品番別a」（ステップ1の出力）
- ターゲット: テーブル「_TG品番別b」
- 対象品番: 
  - **RH**: 53827-60050
  - **LH**: 53828-60080
- 転記データ: 実績、不良実績、稼働時間（稼働時間+段取時間の合計）
- 処理方式: 品番固定・日付ベースでのマッピング転記

**実行タイミング**: 日次（ステップ1実行後）

**転記例**:
```
日付       | RH日実績 | RH日不良実績 | RH日稼働時間 | LH日実績 | LH日不良実績 | LH日稼働時間
2024/01/15 | 180      | 3            | 8.0          | 165      | 2            | 7.5
```

---

### ステップ3: 集計表への詳細転記
**マクロ名**: `m転記_集計表_TG品番別`

**目的**: RH/LH分類データを集計表のTGセクションに転記

**処理内容**:
- ソース: テーブル「_TG品番別b」（ステップ2の出力）
- 基準日付: シート「集計表」セルA1
- 分類構成:
  - **RH**: 右側部品（Lライン列）
  - **LH**: 左側部品（Nライン列）
  - **合計**: RH+LH総合（Pライン列）
- 転記指標: 9種類（日実績、日出来高ｻｲｸﾙ、累計実績、平均実績、累計出来高ｻｲｸﾙ、日不良実績、累計不良数、累計不良率、平均不良数）
- 出力先: シート「集計表」33-42行目、L-P列（3列構成）

**実行タイミング**: 分析時（集計表更新時）

**転記例**:
```
指標             | L列(RH)  | N列(LH)  | P列(合計)
33行目(日実績)    | 180      | 165      | 345
34行目(日出来高)  | 2.1      | 1.9      | 2.0
35行目(累計実績)  | 3240     | 2970     | 6210
```

## 実行順序とタイミング

### 日次処理
1. **m日別集計_TG品番別** - 日別データの品番別集計
2. **m転記_シートTG品番別** - RH/LH分類テーブルへの転記

### 分析時処理
1. **m転記_集計表_TG品番別** - TGセクション詳細データ転記

## データフロー

```
[クエリ全工程] 
    ↓ (日別集計・加工3フィルタ)
[_TG品番別a] 
    ↓ (RH/LH品番転記)
[_TG品番別b] 
    ↓ (詳細転記)
[集計表33-42行目]
```

## TG品番別分析の特徴

### 固定品番システム
- **RH品番**: 53827-60050（右側部品）
- **LH品番**: 53828-60080（左側部品）
- 品番変更時は手動でマクロ修正が必要
- 品番の正確性が分析精度に直結

### RH/LH分類の意義
- **左右対称部品**: 同一製品の左右ペア管理
- **品質比較**: 左右部品間の品質バラツキ分析
- **生産効率**: 左右部品の生産バランス最適化

### 集計表での配置
```
L列: RH → N列: LH → P列: 合計
```

## 重要なポイント

### 品番固定構成システム
- RH/LHの2品番固定構成
- 品番追加時は手動でマクロ修正が必要
- 安定性を重視した設計

### TG工程の特殊性
- 加工3工程のみが対象
- 他の加工工程とは分離された管理
- 精密加工特有の品質管理要求

### データ品質管理
- 空白値は自動的に0に変換
- 品番不一致時は処理対象外
- Debug.Printによる警告出力

## 運用上の注意点

1. **実行順序の遵守**: ステップ1→2→3の順序で実行
2. **品番整合性**: RH/LH品番の正確性確認
3. **工程フィルタ**: 加工3以外は処理対象外
4. **エラー確認**: イミディエイトウィンドウで警告メッセージをチェック

## エラー時の対処

### よくあるエラーと対処法

#### 1. 「品番が見つかりません」
**原因**: RH/LH以外の品番データ
**対処**: 対象品番のデータのみ処理される（正常動作）

#### 2. 「日付が見つかりません」
**原因**: 集計表A1の日付に対応するデータなし
**対処**: データの存在確認、日付形式の確認

#### 3. 「列が見つかりません」
**原因**: テーブル構造の不一致
**対処**: テーブル列名の確認、手動修正

## パフォーマンス特性

- **処理時間**: 通常1-2分（データ量により変動）
- **処理件数**: 日次で2品番分のデータ
- **転記処理**: 27件（3列×9指標）

---

*この文書はTG品番別システムの実際の運用に基づいて作成されています。RH/LH分類分析により、左右対称部品の品質・生産管理が効率化されます。*