# TG作業者別マクロ実行フロー

## 概要

このドキュメントは、TG作業者別データの集計・転記・分析を行う3つのマクロの実行フローを解説します。
これらのマクロは連携して動作し、TG工程（加工3）の日別データから最終的な集計表への転記まで一連の処理を自動化し、作業者別の効率分析を可能にします。

## 全体フロー概要

```
日別データ → 集計 → 動的転記 → 最終出力
```

## 処理ステップ詳細

### ステップ1: 日別集計処理
**マクロ名**: `m日別集計_TG作業者別`

**目的**: TG工程（加工3）の日別データを作業者ごとに集計

**処理内容**:
- ソース: シート「クエリ全工程」テーブル「_クエリ全工程」
- 対象工程: 「加工3」のデータのみ
- 集計キー: 日付 + 作業者名
- 集計項目: 実績、不良、稼働時間、段取時間の合計値
- 出力先: シート「TG作業者別」テーブル「_TG作業者別a」

**実行タイミング**: 日次（データ更新時）

**出力例**:
```
日付       | 作業者 | 実績 | 不良 | 稼働時間 | 段取時間
2024/01/15 | 山田   | 180  | 3    | 7.2      | 0.8
2024/01/15 | 佐藤   | 165  | 2    | 6.9      | 0.6
2024/01/15 | 田中   | 142  | 1    | 6.5      | 0.5
```

---

### ステップ2: 動的列マッピング転記
**マクロ名**: `m転記_シートTG作業者別`

**目的**: 作業者名に基づく動的列マッピングでデータ転記

**処理内容**:
- ソース: テーブル「_TG作業者別a」（ステップ1の出力）
- ターゲット: テーブル「_TG作業者別b」
- 列命名規則:
  - **稼働時間列**: 「{作業者名}稼働時間」
  - **実績列**: 「{作業者名}実績」
- 転記データ: 稼働時間（稼働時間+段取時間の合計）、実績
- 処理方式: 作業者名による動的列検索・日付ベース転記

**実行タイミング**: 日次（ステップ1実行後）

**転記例**:
```
日付       | 山田稼働時間 | 山田実績 | 佐藤稼働時間 | 佐藤実績 | 田中稼働時間 | 田中実績
2024/01/15 | 8.0          | 180      | 7.5          | 165      | 7.0          | 142
```

---

### ステップ3: 集計表への作業者別転記
**マクロ名**: `m転記_集計表_TG作業者別`

**目的**: 作業者別詳細指標データを集計表のTG作業者セクションに転記

**処理内容**:
- ソース: テーブル「_TG作業者別b」（ステップ2の出力）
- 作業者名取得元: シート「集計表」58行目のD,F,H,J,L,N,P列
- 基準日付: シート「集計表」セルA1
- 転記指標: 7種類（実績、日出来高ｻｲｸﾙ、日時間当り出来高、累計、日平均実績、平均出来高ｻｲｸﾙ、平均時間当り数）
- 出力先: シート「集計表」59-65行目（各指標ごとに行分け）

**実行タイミング**: 分析時（集計表更新時）

**転記例**:
```
58行目: 山田,    佐藤,    田中,    鈴木,    高橋,    伊藤,    渡辺
59行目: 180,     165,     142,     128,     115,     98,      85   (実績)
60行目: 2.5,     2.2,     1.9,     1.7,     1.5,     1.3,     1.1  (日出来高ｻｲｸﾙ)
61行目: 22.5,    23.9,    21.8,    18.3,    16.4,    15.0,    12.1 (日時間当り出来高)
```

## 実行順序とタイミング

### 日次処理
1. **m日別集計_TG作業者別** - 日別データの作業者別集計
2. **m転記_シートTG作業者別** - 動的列マッピング転記

### 分析時処理
1. **m転記_集計表_TG作業者別** - 作業者別詳細データ転記

## データフロー

```
[クエリ全工程] 
    ↓ (日別集計・加工3フィルタ)
[_TG作業者別a] 
    ↓ (動的列マッピング転記)
[_TG作業者別b] 
    ↓ (作業者別詳細転記)
[集計表59-65行目]
```

## TG作業者別分析の特徴

### 動的列マッピングシステム
- **列名生成**: 作業者名＋項目名の自動結合
- **柔軟性**: 新規作業者の自動対応
- **効率性**: 作業者数に応じた動的拡張

### 作業者効率分析
- **個人実績**: 作業者別の日次・累積実績
- **効率比較**: 時間当り出来高による効率ランキング
- **品質分析**: 作業者別の不良率分析

### 集計表での配置
```
D列: 作業者1 → F列: 作業者2 → H列: 作業者3 → J列: 作業者4 → L列: 作業者5 → N列: 作業者6 → P列: 作業者7
```

## 重要なポイント

### 動的対応システム
- 作業者名による列の動的検索
- 新規作業者の自動処理
- 拡張性を重視した設計

### TG工程作業者の特殊性
- 加工3工程の専門作業者
- 高精度加工技能者の管理
- 技能レベルによる効率差の可視化

### データ品質管理
- 空白値は自動的に0に変換
- 作業者名の不一致時は処理対象外
- Debug.Printによる警告出力

## 運用上の注意点

1. **実行順序の遵守**: ステップ1→2→3の順序で実行
2. **作業者名整合性**: 各ステップでの作業者名の一致確認
3. **工程フィルタ**: 加工3以外は処理対象外
4. **エラー確認**: イミディエイトウィンドウで警告メッセージをチェック
5. **列存在確認**: 新規作業者用の列が事前に準備されているかチェック

## エラー時の対処

### よくあるエラーと対処法

#### 1. 「列が見つかりません」
**原因**: 作業者名に対応する列が存在しない
**対処**: テーブル列の手動追加、または作業者名の確認

#### 2. 「作業者名が空白です」
**原因**: ソースデータの作業者名が未入力
**対処**: 空白作業者はスキップされる（正常動作）

#### 3. 「日付が見つかりません」
**原因**: 集計表A1の日付に対応するデータなし
**対処**: データの存在確認、日付形式の確認

## パフォーマンス特性

- **処理時間**: 通常2-3分（作業者数により変動）
- **処理件数**: 日次で作業者数分のデータ
- **転記処理**: 最大49件（7作業者×7指標）

## 作業者管理のベストプラクティス

### 事前準備
1. **列構造設計**: 想定作業者数に基づく列設計
2. **命名規則統一**: 作業者名の表記統一
3. **データ整合性**: 各工程での作業者名一致

### 運用管理
1. **定期チェック**: 新規作業者の列追加状況確認
2. **効率分析**: 作業者別効率指標の定期レビュー
3. **技能向上**: 効率データに基づく技能指導

---

*この文書はTG作業者別システムの実際の運用に基づいて作成されています。動的列マッピングにより、作業者構成の変化に柔軟に対応した効率分析が可能になります。*