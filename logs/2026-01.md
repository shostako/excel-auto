# 2026年1月 作業ログ

## 2026-01-12 作業概要

### Windows環境のexcel-autoプロジェクト問題分析

**発端**:
- Windows環境（WezTerm + PowerShell）でexcel-autoプロジェクトを運用
- ファイル読み込み/書き込みでエラーが頻発
- 日本語ファイル名の文字化け

**根本原因特定**:
- Claude CodeのBashツールはGit Bash（`/usr/bin/bash`）を使用
- ナレッジにはPowerShellコマンド（`Get-Content -Encoding oem`）を記載
- bash → pwsh の二重シェル層で日本語パスが文字化け

**調査結果**:
- Claude Codeに`defaultShell`設定は存在しない
- Unix系シェル（bash）前提の設計思想
- PowerShellネイティブ対応は公式には未サポート
- GitHub Issue #6453で同様の問題が報告済み

**結論**:
- excel-autoプロジェクトはWSL環境に戻す
- WSL2（本物のLinux）の方がClaude Codeとの相性が良い

### Windows版ナレッジのWSL版へのマージ

**マージ対象**（環境非依存の知見）:

1. **11-vba-coding-standards.md** に追加:
   - コメント標準セクション（ヘッダーコメント必須/任意項目）
   - 実例（転記マクロ）
   - 「なぜActivateが禁止なのか（過去の失敗から）」詳細セクション
   - 症状診断フロー
   - 最適化の優先順位（黄金律）

2. **12-vba-encoding.md** に追加:
   - 参照名の確認（推測禁止）セクション

**環境依存部分**:
- パス、変換コマンドはWSL用（iconv、bash）のまま維持
- PowerShellコマンドの混入なし

### /vbaコマンド新規作成

**目的**: VBAマクロ生成ワークフローの標準化

**設置場所**: `~/.claude/commands/vba.md`

**内容**:
1. 処理概要確認
2. 情報十分性判断（A: 生成開始 / B: 追加情報）
3. 追加情報収集（Bの場合）
4. 参考マクロ読み込み（iconv変換）
5. excel-vba-expertスキル呼び出し
6. マクロ生成 + bas2sjis変換

**Windows版との差分**: 環境依存コマンドのみ（iconv、bas2sjis bash版）

### WezTermでWSL環境を使う設定

**背景**:
- WSLのUbuntuターミナルではShift+Enterが非対応
- WezTermはShift+Enterをネイティブサポート
- 以前は「wsl → Enter → cd ~」の手間を嫌ってWindows専用にしていた

**解決策**: Logicool Options+でショートカット設定
- ショートカット1: WezTerm → Windows環境（lab用）
- ショートカット2: WezTerm → WSL環境（excel-auto用）

**メリット**:
- 両環境でShift+Enter対応
- ワンクリックで環境切り替え
- WezTermのdefault設定を弄る必要なし

**補足**: WezTermからWSLに入るとカレントディレクトリが`/mnt/c/Users/shost`になる。WSLホームに移動するには`cd ~`。自動化したい場合はWezTerm設定で`--cd ~`オプションを追加。

---
